<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zone of Inhibition Measurement - Antibiotic Effectiveness Plate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

  <!-- p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>

  <style>
    :root {
      --teal-main: #0f766e;
      --teal-soft: #5eead4;
      --bg-soft: #f4fbfa;
      --ink: #0f172a;
      --muted: #6b7280;
      --bacteria: #22c55e;
      --disk-a: #38bdf8;   /* e.g., Penicillin/Œ≤-lactam */
      --disk-b: #f97316;   /* e.g., Tetracycline */
      --disk-c: #6366f1;   /* e.g., Vancomycin or strong agent */
      --plate: #e5e7eb;
      --agar: #fefce8;
      --zone-soft: rgba(148, 163, 253, 0.18);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #e0fbff 0, #f9fafb 60%);
      color: var(--ink);
    }

    .glass-card {
      border-radius: 1.4rem;
      background: rgba(255, 255, 255, 0.98);
      box-shadow:
        0 16px 40px rgba(15, 23, 42, 0.12),
        0 0 0 1px rgba(148, 163, 253, 0.06);
      backdrop-filter: blur(14px);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.66rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--teal-main);
      background: linear-gradient(
        to right,
        rgba(15, 118, 110, 0.08),
        rgba(56, 189, 248, 0.02)
      );
      border: 1px solid rgba(15, 118, 110, 0.18);
    }

    .chip span.dot {
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 999px;
      background: var(--teal-soft);
      box-shadow: 0 0 10px rgba(94, 234, 212, 0.9);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.26rem;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      font-size: 0.64rem;
      color: var(--muted);
      background-color: rgba(15, 118, 110, 0.03);
    }

    .pill-color {
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 999px;
    }

    #sketch-container {
      border-radius: 1rem;
      overflow: hidden;
      background: radial-gradient(circle at top, #e0f2fe, #ffffff);
      border: 1px solid rgba(148, 163, 253, 0.16);
      position: relative;
    }

    .overlay-label {
      position: absolute;
      right: 0.7rem;
      top: 0.5rem;
      padding: 0.16rem 0.6rem;
      border-radius: 999px;
      font-size: 0.6rem;
      background: rgba(255, 255, 255, 0.96);
      color: var(--teal-main);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      box-shadow: 0 4px 10px rgba(148, 163, 253, 0.2);
    }

    .overlay-label span.swatch {
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 999px;
      background: var(--teal-main);
    }

    .btn-step {
      padding: 0.4rem 0.9rem;
      font-size: 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(15, 118, 110, 0.18);
      background-color: rgba(240, 253, 250, 0.98);
      color: var(--teal-main);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
      transition: all 0.18s ease-out;
      white-space: nowrap;
    }

    .btn-step:hover {
      background-color: rgba(209, 250, 229, 0.98);
      box-shadow: 0 4px 10px rgba(148, 163, 253, 0.16);
    }

    .btn-step.primary {
      background-color: var(--teal-main);
      color: #ffffff;
      border-color: transparent;
    }

    .btn-step.primary:hover {
      background-color: #115e59;
      box-shadow: 0 5px 14px rgba(15, 23, 42, 0.22);
    }

    .status-label {
      font-size: 0.66rem;
      color: var(--muted);
    }

    .explain-list {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .explain-list li {
      margin-bottom: 0.12rem;
    }

    .metric-label {
      font-size: 0.65rem;
      color: var(--muted);
    }

    .metric-value {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--teal-main);
    }

    .metric-sub {
      font-size: 0.62rem;
      color: #9ca3af;
    }
  </style>
</head>
<body class="min-h-screen flex justify-center px-4 py-6">
  <main class="w-full max-w-6xl space-y-5">
    <!-- Header -->
    <section class="glass-card px-6 py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="space-y-1.5">
        <div class="chip">
          <span class="dot"></span>
          Antibiotic Testing ‚Ä¢ Zone of Inhibition
        </div>
        <h1 class="text-xl md:text-2xl font-semibold text-slate-900">
          Measure Zones of Inhibition to Compare Antibiotic Effectiveness
        </h1>
        <p class="text-xs md:text-sm text-slate-600 max-w-2xl">
          Drop antibiotic disks onto a bacterial lawn and watch inhibition zones appear.
          Use the on-plate ruler to estimate zone diameters, mirroring the Kirby-Bauer test taught in microbiology labs.
        </p>
      </div>
      <div class="flex flex-col items-end gap-1">
        <div class="pill">
          <span class="pill-color" style="background:#22c55e;"></span>
          Green lawn = susceptible bacteria
        </div>
        <div class="pill">
          <span class="pill-color" style="background:#38bdf8;"></span>
          Colored disks = antibiotics
        </div>
        <div class="status-label text-right">
          Larger clear zones ‚âà stronger or more effective antibiotic (under these conditions).
        </div>
      </div>
    </section>

    <section class="grid gap-4 md:grid-cols-[minmax(0,_1.9fr)_minmax(260px,_1.1fr)] items-stretch">
      <!-- LEFT: Interactive plate -->
      <div class="glass-card p-4 flex flex-col gap-3">
        <!-- Legend -->
        <div class="flex flex-wrap gap-2 text-[0.65rem] text-slate-600">
          <div class="pill">
            <span class="pill-color" style="background:#22c55e;"></span>
            Bacterial lawn (test organism)
          </div>
          <div class="pill">
            <span class="pill-color" style="background:var(--disk-a);"></span>
            Disk A (moderate)
          </div>
          <div class="pill">
            <span class="pill-color" style="background:var(--disk-b);"></span>
            Disk B (weak)
          </div>
          <div class="pill">
            <span class="pill-color" style="background:var(--disk-c);"></span>
            Disk C (strong)
          </div>
          <div class="pill">
            <span class="pill-color" style="background:rgba(148,163,253,0.6);"></span>
            Clear zone = growth inhibited
          </div>
        </div>

        <!-- Canvas -->
        <div id="sketch-container" class="mt-1 w-full aspect-[16/9]">
          <div class="overlay-label">
            <span class="swatch"></span>
            Click to drop antibiotic disks and measure zones
          </div>
        </div>

        <!-- Controls -->
        <div class="mt-3 flex flex-wrap items-center gap-2 text-xs">
          <button id="btnReset" class="btn-step">
            ‚ü≥ Reset plate
          </button>
          <button id="btnSeed" class="btn-step primary">
            1. Seed bacterial lawn
          </button>
          <button id="btnSelectA" class="btn-step">
            A. Moderate antibiotic
          </button>
          <button id="btnSelectB" class="btn-step">
            B. Weak antibiotic
          </button>
          <button id="btnSelectC" class="btn-step">
            C. Strong antibiotic
          </button>
          <button id="btnToggleRuler" class="btn-step">
            üìè Toggle ruler
          </button>
          <div class="pill">
            Mode:
            <span id="modeLabel" class="status-label">Waiting: seed the plate</span>
          </div>
        </div>

        <!-- Summary -->
        <p id="summaryText" class="mt-1 text-[0.7rem] leading-relaxed text-slate-600">
          Start by seeding the plate with a uniform bacterial lawn.
          Choose an antibiotic (A, B, or C), then click on the plate to drop disks.
          Clear zones expand around each disk; use the ruler to estimate which antibiotic produces the largest inhibition zone.
        </p>
      </div>

      <!-- RIGHT: Guidance & measurements -->
      <aside class="glass-card p-4 flex flex-col gap-3">
        <!-- Live measurement readout -->
        <div class="border border-slate-100 rounded-xl px-3 py-2.5 space-y-1.5">
          <div class="text-[0.65rem] font-semibold tracking-wide text-[var(--teal-main)] uppercase flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-[var(--teal-main)]"></span>
            Approximate zone diameters
          </div>
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div>
              <div class="metric-label">Disk A</div>
              <div id="metricA" class="metric-value">‚Äì</div>
              <div class="metric-sub">mm (simulated)</div>
            </div>
            <div>
              <div class="metric-label">Disk B</div>
              <div id="metricB" class="metric-value">‚Äì</div>
              <div class="metric-sub">mm (simulated)</div>
            </div>
            <div>
              <div class="metric-label">Disk C</div>
              <div id="metricC" class="metric-value">‚Äì</div>
              <div class="metric-sub">mm (simulated)</div>
            </div>
            <div>
              <div class="metric-label">Largest zone</div>
              <div id="metricMax" class="metric-value">‚Äì</div>
              <div class="metric-sub">Most effective here</div>
            </div>
          </div>
        </div>

        <!-- How to use -->
        <div class="border border-slate-100 rounded-xl px-3 py-2.5 space-y-1">
          <div class="text-[0.65rem] font-semibold tracking-wide text-sky-700 uppercase flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-sky-400"></span>
            How to use this simulation
          </div>
          <ul class="explain-list list-disc pl-4">
            <li>Click ‚ÄúSeed bacterial lawn‚Äù.</li>
            <li>Select A, B, or C, then click on the plate to place disks.</li>
            <li>Watch clear halos form and stabilize around each disk.</li>
            <li>Toggle the ruler to see a scale; compare halo diameter in ‚Äúmm‚Äù.</li>
          </ul>
        </div>

        <!-- Conceptual meaning -->
        <div class="border border-slate-100 rounded-xl px-3 py-2.5 space-y-1.5">
          <div class="text-[0.65rem] font-semibold tracking-wide text-emerald-700 uppercase flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
            What this teaches
          </div>
          <ul class="explain-list list-disc pl-4">
            <li>Zones of inhibition show where bacteria cannot grow near an antibiotic.</li>
            <li>Larger zones usually mean more effective drug or higher susceptibility.</li>
            <li>This mirrors Kirby-Bauer disk diffusion tests used in clinical labs.</li>
            <li>Real labs use standardized tables; here you build intuition about
              ‚Äúbigger clear zone = stronger effect‚Äù for a given organism.</li>
          </ul>
        </div>
      </aside>
    </section>
  </main>

  <script>
    // Core state for the zone of inhibition simulation

    const modeLabel = document.getElementById("modeLabel");
    const summaryText = document.getElementById("summaryText");

    const metricA = document.getElementById("metricA");
    const metricB = document.getElementById("metricB");
    const metricC = document.getElementById("metricC");
    const metricMax = document.getElementById("metricMax");

    const btnReset = document.getElementById("btnReset");
    const btnSeed = document.getElementById("btnSeed");
    const btnSelectA = document.getElementById("btnSelectA");
    const btnSelectB = document.getElementById("btnSelectB");
    const btnSelectC = document.getElementById("btnSelectC");
    const btnToggleRuler = document.getElementById("btnToggleRuler");

    // Antibiotic potencies: relative zone radii in pixels (will be scaled to canvas)
    const antibiotics = {
      A: { label: "A (moderate)", color: getComputedStyle(document.documentElement).getPropertyValue("--disk-a") || "#38bdf8", potency: 1.0 },
      B: { label: "B (weak)", color: getComputedStyle(document.documentElement).getPropertyValue("--disk-b") || "#f97316", potency: 0.6 },
      C: { label: "C (strong)", color: getComputedStyle(document.documentElement).getPropertyValue("--disk-c") || "#6366f1", potency: 1.4 }
    };

    const state = {
      seeded: false,
      selectedAntibiotic: null,
      disks: [],
      showRuler: true,
      // Pixel-to-mm mapping (approx; updated in setup)
      pxPerMm: 3.0
    };

    function setSummary(text) {
      summaryText.textContent = text;
    }

    function setModeLabel(text) {
      modeLabel.textContent = text;
    }

    function resetSimulation() {
      state.seeded = false;
      state.selectedAntibiotic = null;
      state.disks = [];
      updateMetrics();
      setModeLabel("Waiting: seed the plate");
      setSummary(
        "Plate cleared. Click ‚ÄúSeed bacterial lawn‚Äù to create a uniform field, then choose an antibiotic (A, B, or C) and click on the plate to drop disks. Use the ruler to compare zone diameters."
      );
    }

    btnReset.addEventListener("click", () => {
      resetSimulation();
    });

    btnSeed.addEventListener("click", () => {
      state.seeded = true;
      setModeLabel("Bacterial lawn ready. Choose A, B, or C, then click on the plate.");
      setSummary(
        "The plate now has a confluent bacterial lawn. Select an antibiotic (A/B/C) and click inside the agar to place disks. Clear zones will form around active antibiotics."
      );
    });

    function selectAntibiotic(key) {
      if (!state.seeded) {
        state.seeded = true;
        setSummary(
          "Assuming plate seeded. Now placing antibiotic disks. Clear zones around disks represent inhibited bacterial growth."
        );
      }
      state.selectedAntibiotic = key;
      const ab = antibiotics[key];
      setModeLabel("Selected " + ab.label + ". Click on the plate to drop disks.");
    }

    btnSelectA.addEventListener("click", () => selectAntibiotic("A"));
    btnSelectB.addEventListener("click", () => selectAntibiotic("B"));
    btnSelectC.addEventListener("click", () => selectAntibiotic("C"));

    btnToggleRuler.addEventListener("click", () => {
      state.showRuler = !state.showRuler;
    });

    // p5.js visualization
    let bacteriaPoints = [];
    let plate = { cx: 0, cy: 0, rOuter: 0, rAgar: 0 };

    function setup() {
      const container = document.getElementById("sketch-container");
      const rect = container.getBoundingClientRect();
      const cnv = createCanvas(rect.width, rect.height);
      cnv.parent("sketch-container");
      initPlate();
      resetSimulation();
    }

    function windowResized() {
      const container = document.getElementById("sketch-container");
      const rect = container.getBoundingClientRect();
      resizeCanvas(rect.width, rect.height);
      initPlate();
    }

    function initPlate() {
      const cx = width / 2;
      const cy = height / 2 + 8;
      const rOuter = Math.min(width, height) * 0.78 / 2;
      const rAgar = rOuter * 0.9;
      plate = { cx, cy, rOuter, rAgar };

      // Approximate plate diameter as 90 mm -> define pxPerMm
      const plateMm = 90;
      state.pxPerMm = (rAgar * 2) / plateMm;

      // Pre-populate bacteria distribution within agar
      bacteriaPoints = [];
      const total = 420;
      for (let i = 0; i < total; i++) {
        const ang = random(TWO_PI);
        const rad = random(rAgar * 0.08, rAgar * 0.96);
        const x = cx + cos(ang) * rad;
        const y = cy + sin(ang) * rad;
        bacteriaPoints.push({
          x,
          y,
          phase: random(TWO_PI),
          jitter: random(0.2, 0.7)
        });
      }
    }

    function mousePressed() {
      // Only place disks when clicking inside canvas region
      const container = document.getElementById("sketch-container");
      const rect = container.getBoundingClientRect();
      const withinX = mouseX >= 0 && mouseX <= width;
      const withinY = mouseY >= 0 && mouseY <= height;

      if (!withinX || !withinY) return;
      if (!state.seeded || !state.selectedAntibiotic) return;

      // check inside agar
      const d = dist(mouseX, mouseY, plate.cx, plate.cy);
      if (d > plate.rAgar * 0.95) return;

      const key = state.selectedAntibiotic;
      const ab = antibiotics[key];

      // create a disk with animated zone
      const baseRadiusPx = 6; // disk radius
      const maxZoneRadiusPx = plate.rAgar * 0.14 * ab.potency;

      state.disks.push({
        x: mouseX,
        y: mouseY,
        rDisk: baseRadiusPx,
        rZone: 0,
        rZoneMax: maxZoneRadiusPx,
        color: ab.color,
        key
      });

      setSummary(
        `Disk ${key} placed. Watch its clear zone expand. Use the ruler and readouts to compare diameters between antibiotics.`
      );
      updateMetrics();
    }

    function drawPlateBackground() {
      background(249, 250, 251);

      // Plate outer
      noStroke();
      fill(229, 231, 235, 255);
      circle(plate.cx, plate.cy, plate.rOuter * 2);

      // Agar
      fill(254, 252, 232, 245);
      circle(plate.cx, plate.cy, plate.rAgar * 2);

      // Title above plate
      noStroke();
      fill(148, 163, 253);
      textAlign(CENTER, TOP);
      textSize(8);
      text(
        "Kirby-Bauer style disk diffusion plate (schematic, not to scale)",
        plate.cx,
        plate.cy - plate.rOuter - 10
      );
    }

    function drawBacterialLawn() {
      if (!state.seeded) return;

      noStroke();
      for (let p of bacteriaPoints) {
        p.phase += 0.02;
        const jx = Math.sin(p.phase) * p.jitter;
        const jy = Math.cos(p.phase * 0.7) * p.jitter;
        const x = p.x + jx;
        const y = p.y + jy;

        // inside agar?
        if (dist(x, y, plate.cx, plate.cy) > plate.rAgar * 0.97) continue;

        // default dense green
        let alpha = 170;

        // check inhibition from each disk
        for (let d of state.disks) {
          const distToDisk = dist(x, y, d.x, d.y);
          if (distToDisk < d.rZone * 0.7) {
            alpha = 10; // strongly inhibited
            break;
          } else if (distToDisk < d.rZone) {
            const t = (distToDisk - d.rZone * 0.7) / (d.rZone * 0.3);
            alpha = Math.min(alpha, 40 + 100 * t); // gradient
          }
        }

        fill(34, 197, 94, alpha);
        circle(x, y, 2);
      }
    }

    function drawDisksAndZones() {
      for (let d of state.disks) {
        // Animate zone growth
        if (d.rZone < d.rZoneMax) {
          d.rZone += 0.6; // gentle growth
        }

        // Zone halo
        noStroke();
        for (let i = 0; i < 16; i++) {
          const t = i / 16;
          const r = d.rZone * (0.4 + 0.7 * t);
          const alpha = 36 - 30 * t;
          fill(148, 163, 253, alpha);
          circle(d.x, d.y, r * 2);
        }

        // Disk
        stroke(148, 163, 253, 220);
        strokeWeight(0.8);
        fill(d.color || "#38bdf8");
        circle(d.x, d.y, d.rDisk * 2);

        // Label
        noStroke();
        fill(15, 23, 42);
        textAlign(CENTER, CENTER);
        textSize(7);
        text(d.key, d.x, d.y + 0.2);
      }
    }

    function drawRuler() {
      if (!state.showRuler) return;

      const lengthMm = 30; // show 30 mm span
      const lengthPx = lengthMm * state.pxPerMm;

      const x1 = plate.cx - lengthPx / 2;
      const x2 = plate.cx + lengthPx / 2;
      const y = plate.cy + plate.rAgar + 14;

      // Base line
      stroke(107, 114, 128);
      strokeWeight(1);
      line(x1, y, x2, y);

      // End ticks
      line(x1, y - 4, x1, y + 4);
      line(x2, y - 4, x2, y + 4);

      // Center tick
      const mid = (x1 + x2) / 2;
      line(mid, y - 3, mid, y + 3);

      // Label
      noStroke();
      fill(107, 114, 128);
      textAlign(CENTER, TOP);
      textSize(7);
      text("~30 mm scale (for visual estimation only)", plate.cx, y + 4);
    }

    function updateMetrics() {
      // For each antibiotic type, compute largest zone diameter in mm
      const maxByKey = { A: 0, B: 0, C: 0 };

      for (let d of state.disks) {
        const diameterPx = d.rZone * 2;
        const diameterMm = diameterPx / state.pxPerMm;
        if (diameterMm > maxByKey[d.key]) {
          maxByKey[d.key] = diameterMm;
        }
      }

      const fmt = (v) => (v > 0 ? v.toFixed(1) : "‚Äì");

      metricA.textContent = fmt(maxByKey.A);
      metricB.textContent = fmt(maxByKey.B);
      metricC.textContent = fmt(maxByKey.C);

      // Determine the largest
      const entries = Object.entries(maxByKey).filter(([, v]) => v > 0);
      if (entries.length === 0) {
        metricMax.textContent = "‚Äì";
        return;
      }
      entries.sort((a, b) => b[1] - a[1]);
      const [bestKey, bestVal] = entries[0];
      metricMax.textContent = `${bestKey} (${bestVal.toFixed(1)} mm)`;
    }

    function draw() {
      drawPlateBackground();
      drawBacterialLawn();
      drawDisksAndZones();
      drawRuler();
      updateMetrics();
    }
  </script>
</body>
</html>